<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="itemMapper">

	<resultMap type="com.kh.shop.vo.ItemVO" id="item">
		<id column="ITEM_CODE" property="itemCode"/>
		<result column="ITEM_NAME" property="itemName"/>
		<result column="ITEM_PRICE" property="itemPrice"/>
		<result column="ITEM_DETAIL" property="itemDetail"/>
		<result column="ITEM_STOCK" property="itemStock"/>
		<result column="CATE_CODE" property="cateCode"/>
	</resultMap>
	
	<insert id="insertItem">
		INSERT INTO SHOP_ITEM (
			ITEM_CODE
			, ITEM_NAME
			, ITEM_PRICE
			, ITEM_DETAIL
			, CATE_CODE
		) VALUES (
			(SELECT 'ITEM_' || LPAD(NVL(TO_NUMBER(MAX(SUBSTR(ITEM_CODE, 6, 3))), 0) + 1, 3, 0) FROM SHOP_ITEM)
			, #{itemName}
			, #{itemPrice}
			, #{itemDetail}
			, #{cateCode}
		)
	</insert>

	<resultMap type="com.kh.shop.vo.CategoryVO" id="category">
		<id column="CATE_CODE" property="cateCode"/>
		<result column="CATE_NAME" property="cateName"/>
	</resultMap>
	
	<select id="selectCategoryList" resultMap="category">
		SELECT CATE_CODE
			, CATE_NAME
		FROM ITEM_CATEGORY
	</select>
	
	<resultMap type="com.kh.shop.vo.ImageVO" id="image">
		<id column="IMG_CODE" property="imgCode"/>
		<result column="ORIGIN_IMG_NAME" property="originImgName"/>
		<result column="ATTACHED_IMG_NAME" property="attachedImgName"/>
		<result column="IS_MAIN" property="isMain"/>
		<result column="ITEM_CODE" property="itemCode"/>
	</resultMap>
	
	<insert id="insertImages">
		INSERT INTO ITEM_IMAGE (
			IMG_CODE
			, ORIGIN_IMG_NAME
			, ATTACHED_IMG_NAME
			, IS_MAIN
			, ITEM_CODE
		)
		<foreach collection="imgList" item="img" index="i" separator="UNION ALL">
		SELECT (SELECT 'IMG_' || LPAD(NVL(TO_NUMBER(MAX(SUBSTR(IMG_CODE, 6, 3))), 0) + #{i} + 1, 3, 0) FROM ITEM_IMAGE)
			, #{img.originImgName}
			, #{img.attachedImgName}
			, #{img.isMain}
			, (SELECT MAX(ITEM_CODE) FROM SHOP_ITEM)
		FROM DUAL
		</foreach>
	</insert>
</mapper>












