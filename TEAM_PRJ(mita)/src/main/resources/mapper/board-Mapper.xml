<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boardMapper">

	<resultMap type="com.kh.teamprj.vo.BoardVO" id="board">
		<id column="BOARD_NO" property="boardNo"/>
		<result column="BOARD_TITLE" property="boardTitle"/>
		<result column="BOARD_CONTENT" property="boardContent"/>
		<result column="BOARD_WRITER" property="boardWriter"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="UPDATE_DATE" property="updateDate"/>
		<result column="IS_DELETE" property="isDelete"/>
		<result column="READ_CNT" property="readCnt"/>
		<result column="REPLY_CNT" property="replyCnt"/>
		<result column="CATE_NO" property="cateNo"/>
	</resultMap>
	
	<resultMap type="com.kh.teamprj.vo.BoardCategoryVO" id="category">
		<id column="CATE_NO" property="cateNo"/>
		<result column="CATE_NAME" property="cateName"/>
	</resultMap>
	
	<resultMap type="com.kh.teamprj.vo.ReplyVO" id="reply">
		<id column="REPLY_NO" property="replyNo"/>
		<result column="BOARD_NO" property="boardNo"/>
		<result column="REPLY_CONTENT" property="replyContent"/>
		<result column="REPLY_WRITER" property="replyWriter"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="UPDATE_DATE" property="updateDate"/>
	</resultMap>
	
	<select id="selectBoardCategoryList" resultMap="category">
		SELECT CATE_NO
			, CATE_NAME
		FROM BOARD_CATEGORY
		ORDER BY CATE_NO
	</select>
	
	<select id="selectBoardList" resultMap="board">
		SELECT BOARD_NO
			, BOARD_TITLE
			, BOARD_WRITER
			, TO_CHAR(CREATE_DATE, 'YYYY-MM-DD') AS CREATE_DATE
			, READ_CNT
		FROM BOARD
		ORDER BY BOARD_NO DESC
	</select>
	
	<select id="countBoardList" resultType="int" parameterType="String">
		SELECT COUNT(*)
		FROM BOARD
		<if test="_parameter != null and _parameter != ''">
			WHERE CATE_NO = #{cateNo}
		</if>
	</select>
	
	<select id="selectBoardListPaging" resultMap="board">
		SELECT *
		FROM (
			SELECT ROWNUM RN, A.*
			FROM (
				SELECT BOARD_NO
					, BOARD_TITLE
					, BOARD_WRITER
					, TO_CHAR(CREATE_DATE, 'YYYY-MM-DD') AS CREATE_DATE
					, READ_CNT
				FROM BOARD
				<if test="cateNo != null and cateNo != ''">
					WHERE CATE_NO = #{cateNo}
				</if>
				ORDER BY TO_NUMBER(SUBSTR(BOARD_NO, 7)) DESC
				) A
			WHERE ROWNUM &lt;= #{paging.end}
			)
		WHERE RN &gt;= #{paging.start}
	</select>
	
	<insert id="insertBoard">
		INSERT INTO BOARD (
			BOARD_NO
			, BOARD_TITLE
			, BOARD_CONTENT
			, BOARD_WRITER
			, CATE_NO
		) VALUES (
			(SELECT 'BOARD_' || TO_CHAR(NVL(MAX(TO_NUMBER(SUBSTR(BOARD_NO, 7))), 0) + 1) FROM BOARD)
			, #{boardTitle}
			, #{boardContent}
			, #{boardWriter}
			, #{cateNo}
		)
	</insert>
	
</mapper>












